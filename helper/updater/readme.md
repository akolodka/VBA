# Менеджер обновлений библиотек «Помощник ПКР»
При наличии более чем одного пользователя ПО закономерно возникает вопрос распространения обновлений. 

Установка библиотек *.xlam не требует регистрации в реестре системы и сводится к замене исполняемого файла в каталоге автозапуска MS Office. Но есть нюансы:
- нельзя заменить файл, который в настоящее время используется, а при старте Excel библиотеки запускаются в фоне;
- можно программно закрыть файл надстройки, скопировать обновление и снова подключить файл, но тогда нарушается последовательность отображения меню Ribbon-ленты до следующего перезапуска Excel (надстройки открываются последовательно по алфавиту).

Наиболее гладкий алгоритм установки обновления сводится к трём действиям:
- закрыть файл библиотеки, запущенный в фоне (желательно закрыть Office);
- скопировать файл обновления в служебный локальный каталог автозапуска Office;
- запустить Office.

Открытие служебного каталога вручную через команду «выполнить» утомляет где-то на третий раз.
Применение скрипта VBS, *.py, или bat-файла комфортнее, но всё равно требует вручную закрыть все открытые документы, коих бывает неприлично много в работе. Решение должно быть изящнее, и незаметно работать в среде VBA.

## Область применения
Режимы работы библиотеки:
- стандартный ручной (выполняется проверка наличия обновлений с уведомлением пользователя, установка не производится);
- тихий автоматический (выполняется установка обновлений без уведомления пользователя).

Библиотека распространяется на файлы:
- Excel (*.xlam) — помещаются в каталог:
``` 
%appdata%\Microsoft\Excel\XLSTART\
```
- Word (*.dotm) — помещаются в каталог:
``` 
%appdata%\Microsoft\Word\STARTUP\
```
- Другие файлы, если таковые обнаружены в служебном локальном каталоге «Помощник ПКР» на компьютере пользователя — помещаются в каталог:
``` 
%appdata%\Помощник ПКР\
```

## Принцип работы
Выделено два основных этапа работы библиотеки:
- Проверка доступности обновлений;
- Установка обновлений.

Проверка доступности обновлений выполнется через событие Workbook_Open() и включается в себя операции:
- обращение к каталогу обновлений;
- прохождение по всем файлам, расположенным в каталоге обновлений;
- поиск совпадения имени файла в каталоге обновлений с локальными служебными каталогами;
- сравнение даты изменения файла в каталоге обновлений и соответствующем локальном служебном каталоге;
- переключение флага isUpdateAvailable в положение True, если обнаружен хотя бы один файл новее, чем установленный локально.


## Установка и настройка
Установка возможна только в ручном режиме: поместить в каталог автозагрузки Excel:
``` 
%appdata%\Microsoft\Excel\XLSTART\
```
После установки на Ribbon-ленте Excel повляется выпадающее меню для доступа к настройкам:

![Title](https://github.com/akolodka/VBA/blob/main/resources/updater_RibbonMenu.jpg)

Пользовательская форма:

![Title](https://github.com/akolodka/VBA/blob/main/resources/updater_configMenu.jpg) ![Title](https://github.com/akolodka/VBA/blob/main/resources/updater_configSaveChanges.jpg)

Конфигурация пользователя хранится в файле:
``` 
%appdata%\Помощник ПКР\config\updater.ini
```
Содержимое файла конфигурации:

![Title](https://github.com/akolodka/VBA/blob/main/resources/updater_configContent.jpg)






===================
=====================

глобальные переменные
параметры конфигурации
параметры кеша

обновление недоступно
обновление доступно 

как определяется доступность обновления

как устанавливается обновление word

как устанавливается excel

как устанавливается для прочих файлов


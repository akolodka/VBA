# Менеджер идентификации работ в подразделении

Библиотека реализует третий из четырёх шагов концепции оформления результатов типовой метрологической работы: присвоение уникального идентификатора и передача его по требуемому адресу внутри файла Excel, а также в имя файла.

## Порядок присвоения идентификатора

Каждой типовой работе в подразделении должен быть присвоен идентификатор в формате 
```
ЛЛЛЛ/ХХХХ–ГГГГ
```
где 
- ЛЛЛЛ — номер подразделения;
- ХХХХ — порядковый номер внутри подразделения;
- ГГГГ — год на момент регистрации документов. 

Подразделение, где применяется настоящая библиотека, имеет собственный уникальный номер 210. 
Также внутри подразделения существует разделение на лаборатории: 2101, 2102, 2103, 2104.

Подразделение имеет три направления работ, для которых необходимо вести независимую порядковую внутреннюю нумерацию:
- поверка;
- калибровка;
- измерения.

Для поверочных и калибровочных работ порядковые номера уникальны внутри лаборатории, для измерительной работы порядковые номера общие на всё подразделение, причём такой номер представлен в трёхзначном формате. Для калибровочной и измерительной работы применяются дополнительные символы в идентификаторе. Ниже представлены примеры уникальных идентификаторов. 

Поверочная работа:
```
2104/0123–2023
```
Калибровочная работа:
```
RU 01 № 2104/0123–2023
```
Измерительная работа:
```
210/012–2023–И 
```
Подразделение приняло следующую конвенцию именования файлов обработки результатов измерений по направлениям работ:
- поверочные работы должны иметь префиксы pr_, jr_ и содержать уникальный идентификатор:
```
pr_2104_0123_23.xlsx, jr_2104_0123_23.xlsx
```
- калибровочные работы должны иметь префиксы prc_, jrc_ и содержать уникальный идентификатор:
```
prс_2104_0123_23.xlsx, jrс_2104_0123_23.xlsx
```
- измерительные работы должны иметь префиксы prm_ и содержать уникальный идентификатор в трёхзначном формате:
```
prm_210_012_23.xlsx
```

Каждая лаборатория имеет свой электронный журнал регистрации поверочных работ (файл .xlsx на сервере), в котором хранится информация о выполняемой работе:
- контрагент (принадлежность средства измерений);
- тип средства измерений;
- заводской номер;
- порядковый номер работы;
- дата поверки;
- номер документа, присвоенный федеральным информационным фондом по обеспечению единства измерений;
- исполнители работ;
- ссылка на интернет-запись о поверке.

Общий вид журнала регистрации поверочных работ:

![Title](https://github.com/akolodka/VBA/blob/main/resources/verifyingJournal.jpg)

## Область применения библиотеки

Библиотека выполняет три основные функции:
- открытие в проводнике директории активного файла Excel;
- обмен данными с файлом журнала регистрации поверок на сервере и получение идентификатора работы;
- передача идентификатора работы в тело и наименование активного файла Excel.

Также реализована вспомогательная функция присвоения имени pdf-файлу на основании идентификационных данных работы, хранящихся в текущем файле Excel.

## Принцип работы библиотеки
Представление пользовательской формы изменяется в зависимости от типа выполняемой работы: 
- при запуске в файле Excel, не относящемуся к типовой работе:

![Title](https://github.com/akolodka/VBA/blob/main/resources/numName_MainDefault.jpg)

- при запуске в файле измерительной работы:

![Title](https://github.com/akolodka/VBA/blob/main/resources/numName_MainMeasuring2.jpg)

- при запуске в файле калибровочной работы:

![Title](https://github.com/akolodka/VBA/blob/main/resources/numName_MainCalibration.jpg)

- при запуске в файле поверочной работы:

![Title](https://github.com/akolodka/VBA/blob/main/resources/numName_MainVerifying2.jpg)

------
### Открыть в проводнике каталог активного файла Excel
Особенность работы функции в том, чтобы недопустить повторное открытие каталога, если он был открыт ранее. Чтобы исключить десятки открытых одинаковых окон проводника.

Для поиска ранее открытого каталога выполняется сравнение имени заголовков открытых окон (Shell.Windows).
Для активации ранее открытого окна применяется user32.dll, функции IsIconic и ShowWindow.

------
### Передать идентификатор в текущий файл Excel
Работа функции сводится к трём действиям:
- передать идентификатор из формы пользователя в нужную ячейку активного листа открытой книги Excel;
- передать идентификатор из формы пользователя в имя открытой книги Excel;
- передать заводской номер средства измерений из нужной ячейки на листе в свойство открытого файла.

Передача в ячейку возможна двумя способами:
- поиск ячейки-ключа и передача я смежную ячейку;
- передача в активную ячейку в случае отрицательного результата поиска ключа.

Передача в имя файла выполняется через метод ActiveWorkbook.saveAs и имеет опции:
- с последующим удалением файла, из которого выполняется сохранение (по умолчанию);
- сохранение исходного файла (переключатель «сохранять как копию»).

Передача заводского номера осуществляется во встроенное свойство книги «комменатрий».

------
### Регистрация поверочной работы в журнале на сервере
Функция доступна только для файлов поверочных работ, если журнал регистрации поверок указан в настройках, а также файл журнала доступен по указанному пути.

Some description could be here...

## Установка и настройка библиотеки
Some description could be here...

## Доступ к исходному коду библиотеки из VBA IDE 
Проект библиотеки защищён паролем «1» ввиду обилия компонентов, по умолчанию отображающихся списком в IDE.
